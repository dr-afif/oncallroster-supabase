<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Contacts - HSAAS</title>
  <link rel="stylesheet" href="contacts.css">
  <link rel="stylesheet" href="navbar.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet">
  <style>
    body {
      visibility: hidden;
      opacity: 0;
    }

    body.ready {
      visibility: visible;
      opacity: 1;
      transition: opacity 0.2s ease-in;
    }
  </style>

  <script src="config.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script defer src="./auth/auth.js"></script>
  <script>
    (async () => {
      // Wait for Auth module to load
      if (!window.Auth) {
        await new Promise((resolve) => {
          let tries = 0; const iv = setInterval(() => {
            if (window.Auth) { clearInterval(iv); resolve(); }
            else if (++tries > 300) { clearInterval(iv); resolve(); }
          }, 20);
        });
      }
      try {
        await Auth.initAuth();
        let authed = await Auth.isAuthenticated();
        if (!authed) {
          // Store current path for redirect after login
          const ret = location.pathname + location.search + location.hash;
          sessionStorage.setItem('post_login_redirect', ret);
          location.replace('./login.html');
        } else {
          // Show the page only if authenticated
          document.body.classList.add('ready');
        }
      } catch (err) {
        console.error("Auth Guard error:", err);
        document.body.classList.add('ready');
      }
    })();
  </script>
</head>

<body>
  <div id="page-wrapper">
    <header id="app-header">
      <div class="header-top">
        <img src="hsaas-logo.png" alt="HSAAS Logo" id="logo">
        <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle Dark Mode">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="5" />
            <line x1="12" y1="1" x2="12" y2="3" />
            <line x1="12" y1="21" x2="12" y2="23" />
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" />
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" />
            <line x1="1" y1="12" x2="3" y2="12" />
            <line x1="21" y1="12" x2="23" y2="12" />
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" />
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22">
          </svg>
        </button>
      </div>
      <h1 class="header-title">HSAAS CONTACTS</h1>
      <div id="header-date"></div>
      <div class="search-container">
        <div class="search-input-wrapper">
          <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
            fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8" />
            <line x1="21" y1="21" x2="16.65" y2="16.65" />
          </svg>
          <input type="text" id="global-search-input" placeholder="Search department, doctor or name..."
            oninput="handleSearch()">
        </div>
      </div>
    </header>

    <main class="page-main">
      <div id="departments"></div>
    </main>
  </div>

  <nav class="bottom-nav">
    <button onclick="location.href='fileviewer.html'">
      <svg fill="none" viewBox="0 0 24 24">
        <path d="M14 2H7a3 3 0 0 0-3 3v14a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V8z" />
        <path d="M14 2v6h6" />
      </svg>
      <span>FILE</span>
    </button>
    <button onclick="location.href='index.html'">
      <svg viewBox="0 0 24 24">
        <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" />
      </svg>
      <span>HOME</span>
    </button>
    <button class="active" onclick="location.href='contacts.html'">
      <svg viewBox="0 0 24 24">
        <path
          d="M12 12c2.7 0 4.5-1.8 4.5-4.5S14.7 3 12 3 7.5 4.8 7.5 7.5 9.3 12 12 12zm0 2c-3 0-9 1.5-9 4.5V21h18v-2.5c0-3-6-4.5-9-4.5z" />
      </svg>
      <span>CONTACTS</span>
    </button>
  </nav>

  <script src="contacts.js" defer></script>
  <script src="swipe.js" defer></script>
  <script>
    function toggleTheme() {
      const root = document.documentElement;
      const next = root.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
      root.setAttribute('data-theme', next);
      localStorage.setItem('theme', next);
      if (window.navigator?.vibrate) window.navigator.vibrate(10);
    }
    document.documentElement.setAttribute('data-theme', localStorage.getItem('theme') || 'light');
  </script>
</body>

</html>