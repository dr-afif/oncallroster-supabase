<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HSAAS On-Call Doctor Dashboard</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="navbar.css">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#6366f1">
  <link rel="icon" href="data:,">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet">

  <script defer src="./auth/auth-config.js"></script>
  <script defer src="./auth/auth.js"></script>
  <script>
    (async () => {
      if (!window.Auth) {
        await new Promise((resolve) => {
          let tries = 0; const iv = setInterval(() => {
            if (window.Auth) { clearInterval(iv); resolve(); }
            else if (++tries > 300) { clearInterval(iv); resolve(); }
          }, 20);
        });
      }
      try {
        await Auth.initAuth();
        let authed = await Auth.isAuthenticated();
        if (!authed) {
          await new Promise(r => setTimeout(r, 800));
          authed = await Auth.isAuthenticated();
        }
        if (!authed) {
          const ret = location.pathname + location.search + location.hash;
          sessionStorage.setItem('post_login_redirect', ret);
          location.replace(window.__AUTH0_CONFIG__.publicLoginPage || './login.html');
        }
      } catch (err) { console.error("Auth Guard error:", err); }
    })();
  </script>
</head>

<body>
  <div id="page-wrapper">
    <header id="app-header">
      <div class="header-top">
        <img src="hsaas-logo.png" alt="HSAAS Logo" id="logo">
        <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle Dark Mode">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="5" />
            <line x1="12" y1="1" x2="12" y2="3" />
            <line x1="12" y1="21" x2="12" y2="23" />
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" />
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" />
            <line x1="1" y1="12" x2="3" y2="12" />
            <line x1="21" y1="12" x2="23" y2="12" />
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" />
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22">
          </svg>
        </button>
      </div>
      <h1 class="header-title">ON-CALL DOCTORS</h1>
      <div class="date-navigator">
        <button onclick="changeDate(-1)" aria-label="Previous Day">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
        </button>
        <div class="date-display-wrapper">
          <div id="header-date" onclick="document.getElementById('date-picker').showPicker()"></div>
          <input type="date" id="date-picker" onchange="handleDatePicker(this)"
            style="position: absolute; opacity: 0; pointer-events: none;">
        </div>
        <button onclick="changeDate(1)" aria-label="Next Day">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round">
            <polyline points="9 18 15 12 9 6"></polyline>
          </svg>
        </button>
      </div>
      <div id="data-source">‚è≥ Synchronizing...</div>
      <button id="today-btn" class="hidden" onclick="resetToToday()">Back to Today</button>
      <div class="search-container">
        <div class="search-input-wrapper">
          <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
            fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8" />
            <line x1="21" y1="21" x2="16.65" y2="16.65" />
          </svg>
          <input type="text" id="global-search-input" placeholder="Search department, doctor or name..."
            oninput="handleSearch()">
        </div>
      </div>
    </header>

    <main id="doctor-list"></main>

    <footer id="app-footer">
      <small id="last-updated"></small><br>
      <small>&copy; Dr. Muhammad Afif Abdullah 2025</small>
    </footer>
  </div>

  <nav class="bottom-nav">
    <button onclick="location.href='fileviewer.html'">
      <svg fill="none" viewBox="0 0 24 24">
        <path d="M14 2H7a3 3 0 0 0-3 3v14a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V8z" />
        <path d="M14 2v6h6" />
      </svg>
      <span>FILE</span>
    </button>
    <button class="active" onclick="location.href='index.html'">
      <svg viewBox="0 0 24 24">
        <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" />
      </svg>
      <span>HOME</span>
    </button>
    <button onclick="location.href='contacts.html'">
      <svg viewBox="0 0 24 24">
        <path
          d="M12 12c2.7 0 4.5-1.8 4.5-4.5S14.7 3 12 3 7.5 4.8 7.5 7.5 9.3 12 12 12zm0 2c-3 0-9 1.5-9 4.5V21h18v-2.5c0-3-6-4.5-9-4.5z" />
      </svg>
      <span>CONTACTS</span>
    </button>
  </nav>

  <script src="config.js"></script>
  <script src="script.js" defer></script>
  <script src="swipe.js" defer></script>
  <script>
    function toggleTheme() {
      const root = document.documentElement;
      const next = root.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
      root.setAttribute('data-theme', next);
      localStorage.setItem('theme', next);
      if (window.navigator?.vibrate) window.navigator.vibrate(10);
    }
    document.documentElement.setAttribute('data-theme', localStorage.getItem('theme') || 'light');

    if (window.location.hostname !== 'localhost' && 'serviceWorker' in navigator) {
      window.addEventListener('load', () => { navigator.serviceWorker.register('./service-worker.js'); });
    }
  </script>
</body>

</html>