<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ROSTER FILE VIEWER</title>
  <link rel="stylesheet" href="fileviewer_style.css">
  <link rel="stylesheet" href="navbar.css">
  <script src="fileviewer.js" defer></script>
  <!-- Load Google API -->
  <script async defer src="https://apis.google.com/js/api.js"
          onload="gapiLoaded()"></script>

    <!-- at top of the page (head or very top of body) -->
  <script defer src="./auth/auth-config.js"></script>
  <script defer src="./auth/auth.js"></script>
  <script>
    (async () => {
      // wait for Auth to exist
      if (!window.Auth) {
        await new Promise((resolve, reject) => {
          let tries=0; const iv=setInterval(()=> {
            if (window.Auth) { clearInterval(iv); resolve(); }
            else if (++tries>300) { clearInterval(iv); reject(new Error("Auth not loaded")); }
          }, 20);
        });
      }
      await Auth.initAuth();

      // IMPORTANT: With localstorage cache, this will remain true after navs
      const authed = await Auth.isAuthenticated();
      if (!authed) {
        const ret = location.pathname + location.search + location.hash;
        sessionStorage.setItem('post_login_redirect', ret);
        location.replace(window.__AUTH0_CONFIG__.publicLoginPage || './login.html');
      }
    })();
  </script>

</head>

<body>
  <header id="app-header">
    <img src="icons/logo.png" alt="Logo" id="logo">
    <h1 class="header-title">üìÇ All Rosters</h1>
    <nav id="breadcrumb"></nav>
  </header>

  <main>
    <div id="file-list" class="grid"></div>
  </main>

  <!-- File viewer modal -->
  <div id="viewer-modal" class="modal hidden">
  <div class="modal-content">
    <span id="close-viewer">‚ùå</span>
    <iframe id="file-viewer" frameborder="0"></iframe>
  </div>
</div>

  <nav class="bottom-nav">
    <button class="active" onclick="location.href='fileviewer.html'">
      <div class="stack">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
            viewBox="0 0 24 24" fill="none" stroke="white"
            stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"
            role="img" aria-label="File">
        <path d="M14 2H7a3 3 0 0 0-3 3v14a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V8z"/>
        <path d="M14 2v6h6"/>
        </svg>
        <span>File</span>
      </div>
    </button>

    <button onclick="location.href='index.html'">
      <div class="stack">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
        </svg>
        <span>Home</span>
      </div>
    </button>

    <button onclick="location.href='contacts.html'">
      <div class="stack">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path d="M12 12c2.7 0 4.5-1.8 4.5-4.5S14.7 3 12 3 7.5 4.8 7.5 7.5 9.3 12 12 12zm0 2c-3 0-9 1.5-9 4.5V21h18v-2.5c0-3-6-4.5-9-4.5z"/>
        </svg>
        <span>Contacts</span>
      </div>
    </button>
</nav>

</body>
</html>
